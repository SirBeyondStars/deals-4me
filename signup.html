<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Deals-4Me â€” Sign Up</title>
  <link rel="stylesheet" href="theme.css"/>
</head>
<body>
  <div id="site-toolbar"></div>

  <main>
    <section class="card" style="max-width:420px;margin:24px auto;">
      <h1>Sign Up</h1>
      <form id="signupForm" novalidate>
        <label for="email">Email</label>
        <input id="email" type="email" autocomplete="email" required />

        <label for="pw">Password</label>
        <input id="pw" type="password" autocomplete="new-password" required />

        <label for="pw2">Confirm Password</label>
        <input id="pw2" type="password" autocomplete="new-password" required />

        <button class="btn-primary" type="submit" style="width:100%;margin-top:10px;">Sign Up</button>
        <p class="muted" style="text-align:center;margin-top:8px;">Already have an account? <a href="login.html">Login</a></p>
      </form>
    </section>

    <section class="card" style="max-width:520px;margin:16px auto;">
      <h2>Create Your 4-Digit Household PIN</h2>
      <p class="muted">After verifying your email, set a 4-digit PIN for your household. Everyone will use this PIN with their email to sign in.</p>

      <div class="pin-grid" id="pin1" style="display:flex;gap:.5rem;margin:8px 0;">
        <input class="pin" maxlength="1" inputmode="numeric">
        <input class="pin" maxlength="1" inputmode="numeric">
        <input class="pin" maxlength="1" inputmode="numeric">
        <input class="pin" maxlength="1" inputmode="numeric">
      </div>

      <p class="muted" style="margin:8px 0 6px;">Confirm PIN</p>
      <div class="pin-grid" id="pin2" style="display:flex;gap:.5rem;">
        <input class="pin2" maxlength="1" inputmode="numeric">
        <input class="pin2" maxlength="1" inputmode="numeric">
        <input class="pin2" maxlength="1" inputmode="numeric">
        <input class="pin2" maxlength="1" inputmode="numeric">
      </div>

      <div class="actions" style="display:flex;gap:.5rem;margin-top:.6rem;">
        <button class="save" id="savePin" type="button" style="background:#0f172a;color:#fff;border:none;padding:.55rem .9rem;border-radius:.6rem;cursor:pointer;">Save PIN</button>
        <button class="clear" id="clearPin" type="button" style="background:#e2e8f0;color:#0f172a;border:none;padding:.55rem .9rem;border-radius:.6rem;cursor:pointer;">Clear</button>
      </div>
      <p id="pinMsg" class="muted" role="status" style="margin:.5rem 0 0;"></p>
    </section>
  </main>

  <div id="site-footer"></div>
  <script src="includes.js"></script>
  <script>
    // basic form check
    document.getElementById('signupForm').addEventListener('submit', (e) => {
      e.preventDefault();
      const email = document.getElementById('email').value.trim();
      const p1 = document.getElementById('pw').value;
      const p2 = document.getElementById('pw2').value;
      if (!email || !p1 || p1 !== p2) return alert('Please enter a valid email and matching passwords.');
      alert('Sign-up submitted (demo).');
    });

    // PIN logic
    (function(){
      const $ = s => document.querySelector(s);
      const $$ = s => Array.from(document.querySelectorAll(s));
      function digits(sel){ return $$(sel).map(i => (i.value||'').replace(/\D/g,'')).join(''); }
      function clear(sel){ $$(sel).forEach(i => i.value = ''); }
      function setMsg(el, txt, ok){ el.textContent = txt; el.style.color = ok ? '#16a34a' : '#b91c1c'; }

      $$('.pin, .pin2').forEach(input => {
        input.addEventListener('input', e => {
          e.target.value = e.target.value.replace(/\D/g,'').slice(0,1);
          if (e.target.value && e.target.nextElementSibling) e.target.nextElementSibling.focus();
        });
        input.addEventListener('keydown', e => {
          if (e.key === 'Backspace' && !e.target.value && e.target.previousElementSibling) e.target.previousElementSibling.focus();
        });
      });

      const pinMsg = $('#pinMsg');
      $('#savePin')?.addEventListener('click', () => {
        const email = ($('#email')?.value || '').trim().toLowerCase();
        const p1 = digits('#pin1 .pin');
        const p2 = digits('#pin2 .pin2');
        if (!email || !email.includes('@')) return setMsg(pinMsg, 'Enter a valid email first.', false);
        if (p1.length !== 4 || p2.length !== 4) return setMsg(pinMsg, 'PIN must be exactly 4 digits.', false);
        if (p1 !== p2) return setMsg(pinMsg, 'PINs do not match.', false);
        if (/^(\d)\1{3}$/.test(p1)) return setMsg(pinMsg, 'Avoid simple PINs like 0000 or 1111.', false);
        try { localStorage.setItem('d4m_pin_' + email, p1); } catch {}
        setMsg(pinMsg, 'PIN saved (demo). You can log in now.', true);
      });

      $('#clearPin')?.addEventListener('click', () => { clear('#pin1 .pin'); clear('#pin2 .pin2'); setMsg(pinMsg, '', true); });
    })();
  </script>
</body>
</html>
