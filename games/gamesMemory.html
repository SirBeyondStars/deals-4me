<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Deals-4Me Â· Memory Match</title>

  <!-- Shared site styles & header/footer loader -->
  <link rel="stylesheet" href="/theme.css">
  <script defer src="/theme.js"></script>

  <style>
    .wrap{padding:30px 0}
    .topbar{display:flex;gap:12px;align-items:center;flex-wrap:wrap;margin-bottom:12px}
    .topbar .stat{padding:8px 12px;border:1px solid var(--border);border-radius:12px;background:#fff}
    .controls{margin-left:auto;display:flex;gap:8px;flex-wrap:wrap}
    .btn--primary{background:var(--nav-pill);color:var(--nav-pill-ink);border:1px solid #1e8c67}

    .board{display:grid;gap:10px}
    /* grid sizes adjust by difficulty (JS sets class) */
    .grid-4{grid-template-columns:repeat(4,1fr)}
    .grid-6{grid-template-columns:repeat(6,1fr)}

    .card{
      position:relative; width:100%; aspect-ratio:1/1;
      perspective:900px; cursor:pointer;
    }
    .card-inner{
      position:absolute; inset:0;
      transition:transform .35s ease;
      transform-style:preserve-3d;
    }
    .card.flipped .card-inner,
    .card.matched .card-inner{ transform:rotateY(180deg) }

    .face{
      position:absolute; inset:0; display:flex; align-items:center; justify-content:center;
      border:1px solid var(--border); border-radius:14px; background:#fff;
      backface-visibility:hidden; font-size:38px;
      box-shadow:0 8px 18px rgba(0,0,0,.05);
    }
    .front{
      transform:rotateY(0deg);
      background:linear-gradient(180deg,#ffffff,#f6f8fb);
      color:#0f172a; font-weight:800; font-size:16px; letter-spacing:.4px;
    }
    .front .brand{
      display:flex; flex-direction:column; align-items:center; gap:6px;
      color:#0f172a;
    }
    .front .logo{
      width:30px;height:30px;border-radius:8px;background:var(--logo-box);box-shadow:inset 0 0 0 2px #162848;
    }
    .back{
      transform:rotateY(180deg);
      font-size:42px;
    }
    .card.matched .face{ border-color:#12d18e; box-shadow:0 10px 24px rgba(18,209,142,.15) }

    .notice{margin-top:12px;color:var(--muted)}
  </style>
</head>
<body>
  <!-- Global dark header injects here -->
  <div id="header"></div>

  <main class="container wrap">
    <section class="hero" style="margin-bottom:8px">
      <h1>Memory Match</h1>
      <p class="muted">Flip two cards. If they match, they stay flipped. Clear the board with the fewest moves.</p>
    </section>

    <div class="panel">
      <div class="topbar">
        <div class="stat">Moves: <strong id="moves">0</strong></div>
        <div class="stat">Time: <strong id="time">0:00</strong></div>
        <div class="stat">Matches: <strong id="matches">0</strong></div>

        <div class="controls">
          <label style="display:inline-flex;align-items:center;gap:6px">
            Difficulty
            <select id="difficulty" class="input" style="width:auto">
              <option value="easy">Easy (4Ã—4)</option>
              <option value="hard">Hard (6Ã—6)</option>
            </select>
          </label>
          <button class="btn" id="restart">Restart</button>
          <a class="btn btn--primary" href="/games/games.html">Back to Games</a>
        </div>
      </div>

      <div id="board" class="board grid-4" aria-label="Memory board"></div>
      <p class="notice">Tip: Great focus exercise for kids. We can swap emojis with your own icons later.</p>
    </div>
  </main>

  <!-- Global footer injects here -->
  <div id="footer"></div>

  <script>
    // --- Emoji sets (pairs will be generated) ---
    const EMOJIS = ["ðŸŽ","ðŸŠ","ðŸŒ","ðŸ‰","ðŸ‡","ðŸ“","ðŸ¥‘","ðŸ¥•","ðŸž","ðŸ§€","ðŸ¥š","ðŸ”","ðŸŸ","ðŸŒ®","ðŸ•","ðŸª","ðŸ§ƒ","â˜•ï¸","ðŸ§Š","ðŸ¿","ðŸ§","ðŸŽˆ","ðŸŽ²","ðŸ§©","ðŸª™","ðŸ’¡","â­ï¸","â¤ï¸","ðŸŒŸ","âš½ï¸","ðŸ€","ðŸŽ§","ðŸŽ¸","ðŸš—","ðŸš²"];

    const $ = (id)=>document.getElementById(id);
    const boardEl = $('board');
    const movesEl = $('moves');
    const timeEl  = $('time');
    const matchesEl = $('matches');
    const diffEl = $('difficulty');
    const restartEl = $('restart');

    let state = {
      size: 4,          // 4 or 6
      deck: [],         // [{id, emoji, matched}]
      first: null,      // index of first flipped
      lock: false,
      moves: 0,
      matches: 0,
      startTs: null,
      timerId: null
    };

    // helpers
    const shuffle = (arr)=>arr.sort(()=>Math.random()-0.5);
    const pad2 = (n)=>String(n).padStart(2,'0');

    function startTimer(){
      state.startTs = Date.now();
      clearInterval(state.timerId);
      state.timerId = setInterval(()=>{
        const s = Math.floor((Date.now() - state.startTs)/1000);
        const m = Math.floor(s/60);
        const ss = s%60;
        timeEl.textContent = `${m}:${pad2(ss)}`;
      }, 500);
    }

    function stopTimer(){
      clearInterval(state.timerId);
      state.timerId = null;
    }

    function buildDeck(size){
      const pairs = (size*size)/2;
      const pool = EMOJIS.slice(0, pairs);
      const deck = shuffle([...pool, ...pool]).map((emoji, i)=>({ id:i, emoji, matched:false }));
      return deck;
    }

    function render(){
      // grid size class
      boardEl.classList.toggle('grid-4', state.size===4);
      boardEl.classList.toggle('grid-6', state.size===6);

      // paint cards
      boardEl.innerHTML = '';
      state.deck.forEach((card, idx)=>{
        const el = document.createElement('button');
        el.className = 'card';
        el.setAttribute('aria-label', 'Card');
        el.setAttribute('type','button');
        el.innerHTML = `
          <div class="card-inner">
            <div class="face front">
              <div class="brand">
                <span class="logo" aria-hidden="true"></span>
                <span>Deals-4Me</span>
              </div>
            </div>
            <div class="face back">${card.emoji}</div>
          </div>
        `;
        if (card.matched) el.classList.add('matched');
        el.addEventListener('click', ()=>onFlip(idx, el));
        boardEl.appendChild(el);
      });
    }

    function onFlip(idx, el){
      if (state.lock) return;
      const card = state.deck[idx];
      if (card.matched) return;

      const alreadyFlipped = el.classList.contains('flipped');
      if (alreadyFlipped) return;

      el.classList.add('flipped');

      if (state.first === null){
        // first pick
        state.first = idx;
        if (!state.startTs) startTimer();
      } else {
        // second pick
        state.lock = true;
        state.moves++;
        movesEl.textContent = state.moves;

        const firstIdx = state.first;
        const firstEl = boardEl.children[firstIdx];
        const firstCard = state.deck[firstIdx];

        if (firstCard.emoji === card.emoji){
          // match
          state.deck[firstIdx].matched = true;
          state.deck[idx].matched = true;
          setTimeout(()=>{
            firstEl.classList.add('matched');
            el.classList.add('matched');
            state.matches++;
            matchesEl.textContent = state.matches;
            state.first = null;
            state.lock = false;
            if (state.matches === state.deck.length/2){
              stopTimer();
              setTimeout(()=>alert(`Nice! ${state.moves} moves in ${timeEl.textContent}`), 200);
            }
          }, 250);
        } else {
          // no match
          setTimeout(()=>{
            firstEl.classList.remove('flipped');
            el.classList.remove('flipped');
            state.first = null;
            state.lock = false;
          }, 700);
        }
      }
    }

    function newGame(size){
      state.size = size;
      state.deck = buildDeck(size);
      state.first = null;
      state.lock = false;
      state.moves = 0;
      state.matches = 0;
      movesEl.textContent = '0';
      matchesEl.textContent = '0';
      timeEl.textContent = '0:00';
      stopTimer();
      render();
    }

    // init
    diffEl.addEventListener('change', ()=>{
      const size = diffEl.value === 'easy' ? 4 : 6;
      newGame(size);
    });
    $('restart').addEventListener('click', ()=>{
      const size = diffEl.value === 'easy' ? 4 : 6;
      newGame(size);
    });

    // first load
    newGame(4);
  </script>
</body>
</html>
